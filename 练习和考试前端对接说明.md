# ç»ƒä¹ å’Œè€ƒè¯•å‰ç«¯APIå¯¹æ¥è¯´æ˜

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†EduProå‰ç«¯é¡¹ç›®å¦‚ä½•å¯¹æ¥åç«¯ç»ƒä¹ å’Œè€ƒè¯•ç›¸å…³çš„APIæ¥å£ï¼Œå®ç°å®Œæ•´çš„ç»ƒä¹ å’Œè€ƒè¯•åŠŸèƒ½ã€‚

## ğŸ”§ å·²å®Œæˆçš„å¯¹æ¥å·¥ä½œ

### 1. APIç±»å‹å®šä¹‰
åœ¨ `lib/api.ts` ä¸­æ·»åŠ äº†å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼š

```typescript
// ç»ƒä¹ å’Œè€ƒè¯•ç›¸å…³ç±»å‹
export interface Exam {
  exam_id: number;
  title: string;
  exam_type: 'exercise' | 'final';
  duration_minutes: number;
  total_score: number;
  passing_score: number;
  creator?: User;
  status: string;
  course: Course;
  total_questions: number;
  is_participated: boolean; // å…³é”®å­—æ®µï¼šæ ‡æ³¨ç”¨æˆ·æ˜¯å¦å‚ä¸
}

export interface ExamAttempt {
  attempt_id: number;
  exam: Exam;
  start_time: string;
  submit_time?: string;
  score?: number;
  status: 'in_progress' | 'submitted' | 'graded';
}

// ... æ›´å¤šç±»å‹å®šä¹‰
```

### 2. APIæœåŠ¡æ–¹æ³•
åœ¨ `apiService` å¯¹è±¡ä¸­æ·»åŠ äº†8ä¸ªæ–°çš„APIæ–¹æ³•ï¼š

```typescript
export const apiService = {
  // ç»ƒä¹ ç›¸å…³
  async getExercises(params?: {...}): Promise<ApiResponse<ApiExamListResponse>>
  async getExerciseDetail(exerciseId: number): Promise<ApiResponse<ApiExamDetail>>
  async getMyExerciseStats(): Promise<ApiResponse<ApiExerciseStats>>
  
  // è€ƒè¯•ç›¸å…³
  async getExams(params?: {...}): Promise<ApiResponse<ApiExamListResponse>>
  async getExamDetail(examId: number): Promise<ApiResponse<ApiExamDetail>>
  async getMyExamStats(): Promise<ApiResponse<ApiExamStats>>
  
  // è€ƒè¯•è®°å½•ç›¸å…³
  async getMyExamAttempts(params?: {...}): Promise<ApiResponse<ApiExamAttemptListResponse>>
  async getExamAttemptDetail(attemptId: number): Promise<ApiResponse<ApiExamAttemptDetail>>
}
```

### 3. å‰ç«¯ç»„ä»¶æ›´æ–°

#### ExerciseHub ç»„ä»¶ (`components/ExerciseHub.tsx`)
- å®Œå…¨é‡å†™ï¼Œå¯¹æ¥çœŸå®API
- å®ç°ç»ƒä¹ åˆ—è¡¨å±•ç¤ºï¼Œæ”¯æŒæœç´¢å’Œåˆ†é¡µ
- æ˜¾ç¤ºç”¨æˆ·å‚ä¸çŠ¶æ€ (`is_participated` å­—æ®µ)
- æä¾›ç»Ÿè®¡ä¿¡æ¯é¢æ¿
- æ”¯æŒæŸ¥çœ‹å†å²è®°å½•

#### MockExam ç»„ä»¶ (`components/MockExam.tsx`)
- å®Œå…¨é‡å†™ï¼Œå¯¹æ¥çœŸå®API
- å®ç°è€ƒè¯•åˆ—è¡¨å±•ç¤ºï¼Œæ”¯æŒæœç´¢å’Œåˆ†é¡µ
- æ˜¾ç¤ºç”¨æˆ·å‚ä¸çŠ¶æ€å’Œè€ƒè¯•ç»“æœ
- æä¾›è€ƒè¯•ç»Ÿè®¡ä¿¡æ¯
- æ”¯æŒæŸ¥çœ‹è€ƒè¯•è®°å½•å’Œè¯¦æƒ…

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. è§’è‰²å‚ä¸çŠ¶æ€æ ‡æ³¨
æ¯ä¸ªç»ƒä¹ /è€ƒè¯•éƒ½ä¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å‚ä¸çŠ¶æ€ï¼š

```tsx
// è·å–ç»ƒä¹ çŠ¶æ€æ˜¾ç¤º
const getExerciseStatus = (exercise: Exam) => {
  if (exercise.is_participated) {
    return (
      <Badge variant="secondary" className="bg-green-100 text-green-800">
        <CheckCircle className="h-3 w-3 mr-1" />
        å·²å‚ä¸
      </Badge>
    );
  }
  return (
    <Badge variant="outline">
      <Clock className="h-3 w-3 mr-1" />
      æœªå‚ä¸
    </Badge>
  );
};
```

### 2. ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
æä¾›å®Œæ•´çš„ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ï¼š

```tsx
// ç»ƒä¹ ç»Ÿè®¡
{stats && (
  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <Card>
      <CardContent>
        <div className="text-2xl font-bold">{stats.total_exercises}</div>
        <p className="text-xs text-muted-foreground">å·²å‚ä¸çš„ç»ƒä¹ </p>
      </CardContent>
    </Card>
    // ... æ›´å¤šç»Ÿè®¡å¡ç‰‡
  </div>
)}
```

### 3. æœç´¢å’Œåˆ†é¡µåŠŸèƒ½
æ”¯æŒæŒ‰æ ‡é¢˜ã€è¯¾ç¨‹åç§°æœç´¢ï¼Œä»¥åŠåˆ†é¡µæµè§ˆï¼š

```tsx
// æœç´¢å¤„ç†
const handleSearch = () => {
  setCurrentPage(1);
  const courseId = selectedCourse === "all" ? undefined : parseInt(selectedCourse);
  fetchExercises(1, searchTerm, courseId);
};
```

### 4. æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†
ä½¿ç”¨React Hooksç®¡ç†ç»„ä»¶çŠ¶æ€ï¼š

```tsx
const [exercises, setExercises] = useState<Exam[]>([]);
const [myAttempts, setMyAttempts] = useState<ExamAttempt[]>([]);
const [stats, setStats] = useState<ApiExerciseStats | null>(null);
const [loading, setLoading] = useState(true);
```

## ğŸ“‹ é¡µé¢ç»“æ„

### ç»ƒä¹ é¡µé¢ (`/exercises`)
- **å…¨éƒ¨ç»ƒä¹ ** Tabï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ç»ƒä¹ ï¼Œæ”¯æŒæœç´¢ç­›é€‰
- **æˆ‘çš„è®°å½•** Tabï¼šæ˜¾ç¤ºç”¨æˆ·çš„ç»ƒä¹ è®°å½•å’Œæˆç»©
- ç»Ÿè®¡é¢æ¿ï¼šæ€»ç»ƒä¹ æ•°ã€å·²å®Œæˆæ•°ã€å®Œæˆç‡

### è€ƒè¯•é¡µé¢ (`/exams`)
- **å…¨éƒ¨è€ƒè¯•** Tabï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨è€ƒè¯•ï¼Œæ”¯æŒæœç´¢ç­›é€‰
- **æˆ‘çš„è®°å½•** Tabï¼šæ˜¾ç¤ºç”¨æˆ·çš„è€ƒè¯•è®°å½•å’Œæˆç»©
- ç»Ÿè®¡é¢æ¿ï¼šæ€»è€ƒè¯•æ•°ã€å·²é€šè¿‡æ•°ã€é€šè¿‡ç‡

## ğŸ”— APIè·¯å¾„æ˜ å°„

| å‰ç«¯åŠŸèƒ½ | APIç«¯ç‚¹ | è¯´æ˜ |
|---------|---------|------|
| ç»ƒä¹ åˆ—è¡¨ | `GET /exercises` | è·å–ç»ƒä¹ åˆ—è¡¨ï¼ŒåŒ…å«å‚ä¸çŠ¶æ€ |
| ç»ƒä¹ è¯¦æƒ… | `GET /exercises/{id}` | è·å–ç»ƒä¹ è¯¦ç»†ä¿¡æ¯å’Œé¢˜ç›® |
| è€ƒè¯•åˆ—è¡¨ | `GET /exams` | è·å–è€ƒè¯•åˆ—è¡¨ï¼ŒåŒ…å«å‚ä¸çŠ¶æ€ |
| è€ƒè¯•è¯¦æƒ… | `GET /exams/{id}` | è·å–è€ƒè¯•è¯¦ç»†ä¿¡æ¯å’Œé¢˜ç›® |
| è€ƒè¯•è®°å½• | `GET /my-exam-attempts` | è·å–ç”¨æˆ·çš„è€ƒè¯•è®°å½• |
| è®°å½•è¯¦æƒ… | `GET /my-exam-attempts/{id}` | è·å–å…·ä½“è€ƒè¯•è®°å½•è¯¦æƒ… |
| ç»ƒä¹ ç»Ÿè®¡ | `GET /my-exercises` | è·å–ç”¨æˆ·ç»ƒä¹ ç»Ÿè®¡ä¿¡æ¯ |
| è€ƒè¯•ç»Ÿè®¡ | `GET /my-exams` | è·å–ç”¨æˆ·è€ƒè¯•ç»Ÿè®¡ä¿¡æ¯ |

## ğŸ§ª æµ‹è¯•è¯´æ˜

### å‰ç«¯æµ‹è¯•è„šæœ¬
æä¾›äº† `test-exercise-exam-frontend.js` æµ‹è¯•è„šæœ¬ï¼š

```bash
# åœ¨EduProç›®å½•ä¸‹è¿è¡Œ
node test-exercise-exam-frontend.js
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡**ï¼š
   ```bash
   cd locationPro
   python manage.py runserver
   ```

2. **å¯åŠ¨å‰ç«¯é¡¹ç›®**ï¼š
   ```bash
   cd EduPro
   npm run dev
   ```

3. **ç™»å½•ç”¨æˆ·è´¦å·**ï¼Œç„¶åè®¿é—®ï¼š
   - ç»ƒä¹ é¡µé¢ï¼š`http://localhost:3000/exercises`
   - è€ƒè¯•é¡µé¢ï¼š`http://localhost:3000/exams`

## ğŸ¨ ç”¨æˆ·ç•Œé¢ç‰¹æ€§

### 1. å“åº”å¼è®¾è®¡
- æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- ä½¿ç”¨Tailwind CSSå®ç°å“åº”å¼å¸ƒå±€

### 2. çŠ¶æ€æŒ‡ç¤º
- å‚ä¸çŠ¶æ€ï¼šå·²å‚ä¸/æœªå‚ä¸
- è€ƒè¯•ç»“æœï¼šé€šè¿‡/æœªé€šè¿‡
- è¯„åˆ†çŠ¶æ€ï¼šå·²è¯„åˆ†/å·²æäº¤/è¿›è¡Œä¸­

### 3. äº¤äº’ä½“éªŒ
- åŠ è½½çŠ¶æ€æ˜¾ç¤º
- é”™è¯¯å¤„ç†å’Œæç¤º
- æœç´¢å’Œç­›é€‰åŠŸèƒ½
- åˆ†é¡µæµè§ˆ

## ğŸ”§ é…ç½®è¯´æ˜

### APIåŸºç¡€URL
åœ¨ `lib/api.ts` ä¸­é…ç½®ï¼š

```typescript
const API_BASE_URL = 'http://localhost:8000/api';
```

### è®¤è¯å¤„ç†
æ‰€æœ‰APIè¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦JWT tokenï¼š

```typescript
// æ·»åŠ è®¤è¯tokenï¼ˆå¦‚æœå­˜åœ¨ï¼‰
const token = localStorage.getItem('authToken');
if (token) {
  defaultHeaders['Authorization'] = `Bearer ${token}`;
}
```

## ğŸš€ åç»­å¼€å‘è®¡åˆ’

### 1. ç­”é¢˜åŠŸèƒ½
- å®ç°å®Œæ•´çš„ç­”é¢˜ç•Œé¢
- æ”¯æŒå•é€‰ã€å¤šé€‰ã€åˆ¤æ–­ç­‰é¢˜å‹
- å®æ—¶ä¿å­˜ç­”é¢˜è¿›åº¦

### 2. æˆç»©åˆ†æ
- è¯¦ç»†çš„ç­”é¢˜åˆ†ææŠ¥å‘Š
- é”™é¢˜ç»Ÿè®¡å’Œæ¨è
- å­¦ä¹ å»ºè®®ç”Ÿæˆ

### 3. è€ƒè¯•ç›‘æ§
- è€ƒè¯•æ—¶é—´æ§åˆ¶
- é˜²ä½œå¼Šæœºåˆ¶
- è€ƒè¯•ç¯å¢ƒæ£€æµ‹

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. åç«¯APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ç”¨æˆ·æ˜¯å¦å·²æ­£ç¡®ç™»å½•
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0.0** (2024-01-XX)ï¼šå®ŒæˆåŸºç¡€APIå¯¹æ¥
  - ç»ƒä¹ å’Œè€ƒè¯•åˆ—è¡¨å±•ç¤º
  - ç”¨æˆ·å‚ä¸çŠ¶æ€æ ‡æ³¨
  - ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
  - è€ƒè¯•è®°å½•æŸ¥çœ‹

---

é€šè¿‡ä»¥ä¸Šå®ç°ï¼ŒEduProå‰ç«¯é¡¹ç›®å·²æˆåŠŸå¯¹æ¥åç«¯ç»ƒä¹ å’Œè€ƒè¯•APIï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„ç»ƒä¹ å’Œè€ƒè¯•åŠŸèƒ½ä½“éªŒã€‚ 